## 自上而下的设计原则 TDD(Top-Down Design)

到目前为止，我们所讨论的问题导致了一个不可避免的结论：组件结构不能从顶部向下设计。它不是系统中最早设计的部分，而是随着系统的增长和变化而发展的。

有些读者可能会觉得这一点很反直觉。我们已经习惯了大粒度的分解，比如组件，也将是高层次的功能分解。

当我们看到一个颗粒度的组合，比如组件依赖结构，我们认为这些组件应该以某种方式代表系统的功能。然而，这似乎并不是组件依赖图的一个属性。

实际上，组件依赖图与描述应用程序功能的关系非常少。相反，它们是应用程序可构建性和可维护性的地图。这就是为什么它们不是在项目开始时设计的原因。没有软件可构建或维护，因此不需要构建和维护地图。但随着越来越多的模块在实施和设计的早期阶段累积，有一个越来越大的需求来管理依赖关系，以便项目可以在没有"第二天早上综合症”的情况下开发。此外，我们希望尽可能地将变更局部化，因此开始关注SRP和CCP，并将可能一起更改的类放在一起。

这种依赖结构的一个主要问题是挥发性的隔离。我们不希望频繁更改的组件影响本来应该稳定的组件。例如，我们不希望GUI的外观变化对业务规则产生影响。我们不希望添加或修改报告对我们的最高级政策产生影响。因此，组件依赖图由架构师创建和塑造，以保护稳定的高价值组件免受不稳定的组件的影响。

随着应用程序的不断增长，我们开始关注创建可重用的元素。此时，CRP开始影响组件的构成。最后，随着周期的出现，ADP被应用，组件依赖图会颤动和增长。

如果我们试图在设计任何类之前设计组件依赖结构，我们很可能会失败。我们不会了解共同就近性(CCP)，也不会意识到任何可重用的元素，我们几乎肯定会创建产生依赖循环的组件。因此，组件依赖结构随着系统的逻辑设计而增长和发展。